<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Home - HeartMatch</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Inter", sans-serif;
      }
      body.min-h-screen {
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }
      main {
        flex-grow: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        padding-bottom: 80px;
      }
      nav {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        max-width: 100%; /* Ensure it spans full width on smaller screens */
        background-color: white;
        border-top: 1px solid #e5e7eb;
        padding: 1rem 0;
        box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.05);
        display: flex;
        justify-content: space-around;
        align-items: center;
        z-index: 50; /* Ensure footer is above other content */
      }
      nav button {
        flex: 1; /* Distribute space evenly */
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 0.5rem;
        transition: color 0.2s ease-in-out;
      }
    </style>
  </head>
  <body
    class="bg-gradient-to-br from-purple-100 to-pink-100 flex flex-col min-h-screen"
  >
    <main class="flex-grow flex items-center justify-center p-6">
      <div
        class="w-full max-w-md bg-white rounded-2xl shadow-xl p-8 space-y-6 transform transition-all duration-300 hover:scale-105"
      >
        <header class="text-center">
          <h1 class="text-5xl font-extrabold text-pink-600 mb-2 drop-shadow-md">
            HeartMatch
          </h1>
          <p class="text-gray-600 text-lg">Find your perfect match!</p>
          <a
            href="/logout"
            class="text-sm text-blue-500 hover:underline font-semibold mt-2 inline-block"
            >Logout</a
          >
        </header>

        <div
          id="profile-card"
          class="bg-gradient-to-br from-pink-400 to-purple-500 text-white rounded-2xl p-6 shadow-lg text-center"
        >
          <img
            id="current-profile-pic"
            src="https://placehold.co/120x120/ffffff/000000?text=Profile"
            alt="Profile Picture"
            class="w-32 h-32 rounded-full border-4 border-white mx-auto mb-4 object-cover"
          />
          <h3 id="current-profile-name" class="text-3xl font-bold">
            Name, Age
          </h3>
          <p id="current-profile-bio" class="text-sm italic">"Bio goes here"</p>
          <p id="current-profile-location" class="text-sm font-light mt-2">
            Location: Unknown
          </p>
        </div>

        <!-- Profile count -->
        <p
          id="profile-count"
          class="text-center text-gray-600 font-semibold"
        ></p>

        <div class="flex justify-around mt-4">
          <button
            id="dislike-btn"
            class="bg-red-500 text-white p-4 rounded-full shadow-lg hover:bg-red-600 transition duration-300 ease-in-out transform hover:scale-110 focus:outline-none focus:ring-2 focus:ring-red-400"
          >
            <span class="text-3xl">❌</span>
          </button>
          <button
            id="like-btn"
            class="bg-green-500 text-white p-4 rounded-full shadow-lg hover:bg-green-600 transition duration-300 ease-in-out transform hover:scale-110 focus:outline-none focus:ring-2 focus:ring-green-400"
          >
            <span class="text-3xl">✅</span>
          </button>
        </div>

        <!-- Feedback message -->
        <p
          id="feedback-msg"
          class="text-center text-green-600 font-semibold mt-4 min-h-[1.5rem]"
        ></p>

        <p class="text-center text-gray-500 text-sm mt-4">
          Swipe left to pass, right to like!
        </p>
      </div>
    </main>

    <!-- Footer / Bottom Navigation -->
    <nav>
      <a href="/home" class="text-pink-500 flex flex-col items-center">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-6 w-6"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
          stroke-width="2"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"
          />
        </svg>
        <span class="text-xs mt-1">Home</span>
      </a>
      <a
        href="/profile"
        class="text-gray-600 hover:text-pink-500 flex flex-col items-center"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-6 w-6"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
          stroke-width="2"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"
          />
        </svg>
        <span class="text-xs mt-1">Profile</span>
      </a>
      <a
        href="/chats"
        class="text-gray-600 hover:text-pink-500 flex flex-col items-center"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-6 w-6"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
          stroke-width="2"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"
          />
        </svg>
        <span class="text-xs mt-1">Chats</span>
      </a>
    </nav>

    <script>
      // Profiles array passed from the server
      let profiles = <%- JSON.stringify(profiles) %>; // Dynamically populate profiles

      let currentIndex = 0;

      // Update profile count display
      function updateProfileCount() {
        const countText =
          currentIndex < profiles.length
            ? `Profile ${currentIndex + 1} of ${profiles.length}`
            : "No more profiles";
        document.getElementById("profile-count").innerText = countText;
      }

      function loadProfile() {
        if (currentIndex >= profiles.length) {
          document.getElementById("profile-card").style.display = "none";
          document.querySelector(".flex.justify-around").style.display = "none";
          document.getElementById("feedback-msg").innerText =
            "No more profiles to show! Check back later.";
          updateProfileCount();
          return;
        }
        const profile = profiles[currentIndex];
        document.getElementById("current-profile-pic").src = profile.profilePic;
        document.getElementById("current-profile-name").innerText = `${profile.name || profile.email.split('@')[0]}, ${profile.age || 'N/A'}`;
        document.getElementById("current-profile-bio").innerText = profile.bio || '"Ready to find my heartmatch!"';
        document.getElementById("current-profile-location").innerText = `Location: ${profile.location || 'Unknown'}`;

        updateProfileCount();
      }

      function sendChoice(isLike) {
        if (currentIndex >= profiles.length) return;

        const profile = profiles[currentIndex];
        document.getElementById("feedback-msg").innerText = isLike
          ? `You liked ${profile.name}!`
          : `You passed on ${profile.name}.`;

        currentIndex++;
        loadProfile();
      }

      document.getElementById("like-btn").addEventListener("click", () => {
        sendChoice(true);
      });

      document.getElementById("dislike-btn").addEventListener("click", () => {
        sendChoice(false);
      });

      // Initial load
      loadProfile();
    </script>
  </body>
</html>
